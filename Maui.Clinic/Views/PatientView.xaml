<?xml version="1.0" encoding="utf-8" ?>
<ContentPage 
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:viewmodels="clr-namespace:Maui.Clinic.ViewModels"
    xmlns:model="clr-namespace:Library.Clinic.Models;assembly=Library.Clinic"
    x:Class="Maui.Clinic.Views.PatientView"
    x:DataType="viewmodels:PatientViewModel"
    Title="{Binding Title}">
    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">
            <!-- Patient List -->
            <CollectionView ItemsSource="{Binding Patients}">
                <CollectionView.Header>
                    <Button Text="Add New Patient" 
                            Command="{Binding AddNewPatientCommand}"
                            HorizontalOptions="Start"/>
                </CollectionView.Header>
                <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="model:Patient">
                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems>
                                <SwipeItem Text="Edit"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.EditPatientCommand}"
                                        CommandParameter="{Binding .}"/>
                                <SwipeItem Text="Delete"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeletePatientCommand}"
                                        CommandParameter="{Binding .}"
                                        BackgroundColor="Red"/>
                            </SwipeItems>
                        </SwipeView.RightItems>
                        <Frame Padding="10" Margin="5">
                            <VerticalStackLayout>
                                <Label Text="{Binding Name}" 
                                    FontAttributes="Bold" 
                                    FontSize="16"/>
                                <Label Text="{Binding BirthDate, StringFormat='{0:d}'}"
                                    TextColor="{StaticResource Gray600}"/>
                            </VerticalStackLayout>
                        </Frame>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Edit Form (initially hidden) -->
            <Frame IsVisible="{Binding IsEditing}" 
                   Padding="15" 
                   BorderColor="{StaticResource Gray300}">
                <VerticalStackLayout Spacing="10">
                    <Entry Placeholder="Full Name" 
                           Text="{Binding Name}"/>
                    
                    <DatePicker Date="{Binding BirthDate}"/>
                    
                    <Picker Title="Gender"
                            ItemsSource="{Binding Genders}"
                            SelectedItem="{Binding Gender}"/>
                    
                    <Picker Title="Race"
                            ItemsSource="{Binding Races}"
                            SelectedItem="{Binding Race}"/>
                    
                    <Editor Placeholder="Address" 
                           Text="{Binding Address}"
                           HeightRequest="80"/>
                    
                    <HorizontalStackLayout Spacing="10" 
                                          HorizontalOptions="End">
                        <Button Text="Cancel"
                                Command="{Binding CancelEditCommand}"/>
                        <Button Text="Save" 
                                Command="{Binding SaveCommand}"
                                IsEnabled="{Binding SaveCommand.CanExecute, Mode=OneWay}"/>
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Frame>

            <ActivityIndicator IsRunning="{Binding IsBusy}" 
                             IsVisible="{Binding IsBusy}"/>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>